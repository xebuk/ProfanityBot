# ProfanityBot

---
### ***Telegram-бот, который следит за своей речью.***

В данном репозитории лежит код Telegram-бота @prfnt_bot, который следит за
красотой речи в чате и выписывает штрафы за её порчу.

---
### ***Функционал бота***

Анализирует весь входящий текст, голосовые сообщения и видео-заметки на предмет обсценной лексики.
При обнаружении таковой в речи добавляет количество обнаруженного мата в таблицу /curses.

---
### ***Команды, которые доступны в боте:***

- ***/curse*** - выводит топ среди всех участников чата по количеству плохих слов. Тем их меньше, тем ты выше по порядку.
- ***/change_curse*** - принимает два аргумента - тег пользователя и число. Добавляет (>0) или уменьшает баллы (<0) рейтинга на указанное число.
- ***/reset*** - обнуляет всем счетчик обсценной лексики. Доступна только администраторам и владельцу чата.
- ***/all*** - аналог @all в Дискорде и иже с ними.
- ***/donate*** - выводит ссылку для доната или оплаты штрафа. Ссылка для каждого чата своя.
- ***/set_donate*** - установить ссылку для доната или оплаты штрафа. Доступна только администраторам и владельцу чата.
- ***/random_send*** - переключает статус случайной отправки для чата.
При включенном состоянии с периодом от 1 до 6 часов отправляет специфичное для данного чата сообщение. Доступна только администраторам и владельцу чата.
- ***/set_random_send*** - установить сообщение для случайной отправки. Доступна только администраторам и владельцу чата.

---
### ***Псевдокоманды, которые доступны в боте***

Набор некоторых подстрок, на которые реагирует бот.
- ***/сурсе*** - отправляет случайный стикер или гифку.
- ***сосал*** - отправляет ответное "сосал"
- ***Я*** и ***проиграл*** в одном сообщении - отправляет ответное "я проиграл"

---
### ***Стек технологий***

- Python
  - python-telegram-bot
  - numpy
  - pandas
  - scipy
  - scikit-learn
  - imbalanced-learn
  - sqlite3 (Можно использовать другую базу данных, такую как PostgreSQL или MySQL)
- ffmpeg
- Docker
  - Docker-compose
- Git)

---
### ***Файлы, которые есть в репозитории:***

- ***main.py*** - Основной код бота. Описывает его функционал и является точкой его запуска.
- ***logs.py*** - Модуль, отвечающий за ведение логов работы бота. 
- ***textutil.py*** - Модуль, отвечающий за обработку и анализ текста, который ловит бот. Также содержит в себе слот для ML-модели.
- ***database.py*** - Модуль, отвечающий за взаимодействие с базой данных.
- ***model-training.py*** - Модуль, отвечающий за обучение ML-модели для определения обсценной лексики.
- ***speech_recognition.py*** - Модуль, отвечающий за подгрузку STT-модели. 
На данный момент использует openai-whisper large-v3, которая развертывается локально.
- ***requirements.txt*** - Набор библиотек, которые необходимы для работы каждого файла.
- ***Dockerfile*** - Нужен для создания Docker-контейнера с ботом.
- ***docker-compose.yaml*** - Нужен для синхронизации проекта с тем, что есть на контейнере.

---
### ***Файлы, которых нет в репозитории:***

- ***.env*** - желателен как хранилище для метаданных бота, таких как его токен.
- ***chats_with_curse.db*** - база данных с информацией и статистикой обсценной лексики в чатах.
- ***log.txt*** - логи работы бота.
- ***profanity_pipeline.joblib*** - ML-модель для анализа текста на предмет обсценной лексики.
- ***curses.txt*** - обсценная лексика, которая была обнаружена ботом. Анализуется на предмет ложного срабатывания для улучшения модели.
- ***warnings.txt*** - все слова, которые преодолели порог явления подозрительным словом, но не преодолели порог обсценной лексики.
- ***normal_words.txt*** - все остальные слова. Также, как и curses.txt, существует для анализа на предмет пропуска обсценной лексики для улучшения модели.
- ***Великий Могучий.txt*** - пример хороших слов для ML-модели.
- ***Тёмная сторона.txt*** - пример плохих слов для ML-модели.
